{% extends "dealer/dashboard_sample.html" %}
{% block content %}
{% load static %}



<!-- partial -->
<div class="main-panel">
  <div class="content-wrapper">
    <div class="page-header">
      <h3 class="page-title"> Today orders </h3>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="#">Tables</a></li>
          <li class="breadcrumb-item active" aria-current="page">Order tables</li>
        </ol>
      </nav>
    </div>
    <div class="row">
      <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Today Orders</h4>

            </p>
            <table class="table">
              <thead>
                <tr>
                  <th>
                    <h5>Order Id</h5>
                  </th>
                  <th>
                    <h5>Customer</h5>
                  </th>
                  <th>
                    <h5>Order Date</h5>
                  </th>
                  <th>
                    <h5>Order Total</h5>
                  </th>
                  <th>
                    <h5>Items</h5>
                  </th>
                  <th>
                    <h5>Status</h5>
                  </th>
                </tr>
              </thead>
              <tbody>
                {% for orders in order %}
                <tr>

                  <td>{{orders.transaction_id}}</td>
                  <td> {{orders.customer.name}}</td>
                  <td>{{orders.date_ordered}}</td>
                  <td>${{orders.product_total}}</td>


                  <td>
                    <!-- Button to Open the Modal -->
                    <button type="button" class="badge badge-success" data-toggle="modal" data-target="#myModal">
                      View Items
                    </button>


                    <!-- The Modal -->
                    <div class="modal" id="myModal">
                      <div class="modal-dialog">
                        <div class="modal-content">

                          <!-- Modal Header -->
                          <div class="modal-header">
                            <h4 class="modal-title">Item Listing</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                          </div>

                          <!-- Modal body -->
                          <div class="modal-body">
                            <table class="table table-striped">
                              <thead>
                                <tr>
                                  <th>Item name</th>
                                  <th>Price</th>
                                  <th>catogery</th>
                                  <th>Total price</th>
                                </tr>
                              </thead>
                              <tbody>
                                {% for item in orders.orderitem_set.all %}
                                <tr>
                                  <td>{{item.product.name}}</td>
                                  <td>{{item.product.newprice}}</td>
                                  <td>{{item.product.product_category}}</td>
                                  <td>asdfas</td>
                                </tr>
                                {% endfor %}
                              </tbody>
                            </table>
                          </div>

                          <!-- Modal footer -->
                          <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                          </div>

                        </div>
                      </div>
                    </div>
          </div>

          </td>
          <td>
            <div class="btn-group">
              <button type="button" class="actual_status btn btn-info btn-md">{{orders.order_status}}</button>
              
              <button type="button" class="btn btn-info btn-md dropdown-toggle px-3" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                <span class="sr-only">Toggle Dropdown</span>
              </button>
              <div class="dropdown-menu">

                <button data-id="{{orders.id}}" data-status="Packed" class="change_status dropdown-item">Packed</button>

                <button data-id="{{orders.id}}" data-status="Out for delivery" class="change_status dropdown-item">Out
                  for delivery</button>


              </div>
            </div>
          </td>
          </tr>
          {% endfor %}
          </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>
<!-- content-wrapper ends -->
<!-- partial:../../partials/_footer.html -->


  
<script>
  function getCookie(name) {
   let cookieValue = null;
   if (document.cookie && document.cookie !== '') {
     const cookies = document.cookie.split(';');
     for (let i = 0; i < cookies.length; i++) {
       const cookie = cookies[i].trim();
       // Does this cookie string begin with the name we want?
       if (cookie.substring(0, name.length + 1) === (name + '=')) {
         cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
         break;
       }
     }
   }
   return cookieValue;
 }
 var csrftoken = getCookie('csrftoken');
 
     /*var btn = document.getElementById('order_status1')
     btn.addEventListener('click',function(){
         alert('ok')
         var top = document.getElementById('actual_status')
         top.innerHTML = 'changed'
     })*/
 
var statusBtns = document.getElementsByClassName('change_status')

for(var i = 0; i < statusBtns.length; i++){
 statusBtns[i].addEventListener('click', function(){
 console.log('value of I:',i)
 var orderId = this.dataset.id
 var status = this.dataset.status
 console.log('orderId:', orderId, 'status :', status)
 var top = document.getElementsByClassName('actual_status')
 top.innerHTML = status
 // location.reload()

 $.ajax({

     url: '/update_order/',
     type: 'POST',
     data: {
       order_id: orderId,
       order_status:status,
       csrfmiddlewaretoken: csrftoken
     },
     
   //   success: function(result){
   // $(".actual_status").html(status);
   //   }
 });
 })
}
</script>  



{% endblock %}